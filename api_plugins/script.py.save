from pykeyboard import InlineKeyboard , InlineButton
from bot import Api, Cli
from helper.utils import *
from helper.db_tools import *
from pykeyboard import InlineButton , InlineKeyboard, ReplyButton , ReplyKeyboard
from asyncio import sleep
import jdatetime

def get_current_jalali_datetime():
    return jdatetime.datetime.now().strftime('%Y-%m-%d Ø³Ø§Ø¹Øª  %H:%M')
admin_action=''
@Api.on_message(is_admin)
async def handle_admin_messages(c,m):
    global admin_action
    user_id = m.from_user.id
    name = m.from_user.first_name
    user_name = f'[{name}](tg://user?id={user_id})'
    text= m.text
    if text=='/start':
        admin_dash_kb = InlineKeyboard(row_width=2)
        admin_dash_kb.add(
            InlineButton("ğŸ”§ Ù…Ø¯ÛŒØ±ÛŒØª Ú†Øª Ù‡Ø§","manage-chats"),
            InlineButton("âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ø¨Ø§Øª","bot-setting"),

            InlineButton("ğŸ“Ø±Ø§Ù‡Ù†Ù…Ø§","help"),

        )
        
        admin_dash_text = """Ø³Ù„Ø§Ù… {} Ø¹Ø²ÛŒØ² ğŸ‘‹ğŸ»
    âœ¦ Ø§Ø¯Ù…ÛŒÙ† Ù…Ø­ØªØ±Ù… Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ø§Ù…Ù‡ ÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡ Ù‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯

    [â€ ](https://telegra.ph/file/7dbf04b6aa0c6edb6b143.jpg)""".format(user_name)
        await m.reply(text=admin_dash_text,reply_markup=admin_dash_kb)
        
    elif admin_action=='add_chat':
        loading = await m.reply('Ù„Ø·ÙØ§ ØµØ¨Ø± Ú©Ù†ÛŒØ¯...')
        if "/" in text:
            text = text.split('/')[-1]
        else:
            text = text.replace("@","")  
        try:      
            await Cli.join_chat(text)
            chat = await Cli.get_chat(text)
            numeral_chat_id = chat.id
            chat_title = chat.title
            memebers = chat.members_count
            lock_forward = chat.has_protected_content
            chat_username=chat.username
            
            report_text = """
     Ø¹Ù†ÙˆØ§Ù† Ú†Ù€Ù€Ù€Ù†Ù€Ù€Ù„ :
    â€ğŸŒ€ {}

     Ø¢ÛŒÙ€Ù€Ù€Ø¯ÛŒ Ø¹Ø¯Ø¯ÛŒ  : 
    â€ğŸŒ€ <code>{}</code>

     ØªØ¹Ù€Ø¯Ø§Ø¯ Ø§Ø¹Ù€Ø¶Ø§  :
    â€ğŸŒ€ __{}__

     Ù†Ø§Ù… Ú©Ù€Ù€Ù€Ù€Ø§Ø±Ø¨Ù€Ø±ÛŒ  :
    â€ğŸŒ€ <code>{}</code>

     Ø²Ù…Ø§Ù† Ø¹Ø¶ÙˆÛŒØª  :
    â€ğŸŒ€ {}


    [â€ ](https://telegra.ph/file/57f194a58e5b861db1a3e.jpg)""".format(
        chat_title,
        str(numeral_chat_id),
        str(memebers),
        str(chat_username),
        str(get_current_jalali_datetime())
    )
            add_chat(chat_id=numeral_chat_id,title=chat_title)
            print(chat)
            admin_action = ''
            
            chat_setting_kb = InlineKeyboard(row_width=1)
            chat_setting_kb.add(
                InlineButton("âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú†Ù†Ù„","settings:{}".format(str(numeral_chat_id))),
                InlineButton("ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª","back-to-main")
            )
            await loading.delete()
            await m.reply(text=report_text,reply_markup=chat_setting_kb)
            
        except Exception as e :
            await loading.delete()
            back_to_manage_chat_kb = InlineKeyboard()
            back_to_manage_chat_kb.add(
                InlineButton("ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª","back-manage-chat")
            )
            await m.reply(f"Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯ Ø¨Ø§ Ø³Ø§Ù¾ÙˆØ±Øª Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ú¯ÛŒØ±ÛŒØ¯\n<code>{e}</code>",reply_markup=back_to_manage_chat_kb)      
            
    elif admin_action.split(":")[0]=='filter-words':
        await m.reply("ÙÛŒÙ„ØªØ± Ú©Ù„Ù…Ø§Øª Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯")
        chat = admin_action.split(":")[1] 
        chat_collection.update_one({"_id":int(chat)},{"$set":{"keyword":m.text}})
        save_chats()
        admin_action = ''
    elif admin_action.split(":")[0]=='filter-numbers':
       await m.reply("ÙÛŒÙ„ØªØ± ØªØ¹Ø¯Ø§Ø¯ Ù¾ÛŒØ§Ù… Ù‡Ø§ÛŒ Ø§Ø² Ø§ÛŒÙ† Ú†Ù†Ù„ Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯")
       chat = admin_action.split(":")[1]  
       chat_collection.update_one({"_id":int(chat)},{"$set":{"message_per_day":int(m.text),"sent_messages":0}})
       save_chats()    
       admin_action =''
       




@Api.on_callback_query()
async def handle_btn(c,q):
    global admin_action
    query =q.data
    
    user_id = q.from_user.id
    name = q.from_user.first_name
    user_name = f'[{name}](tg://user?id={user_id})'
    back_to_manage_chat_kb = InlineKeyboard()
    back_to_manage_chat_kb.add(
        InlineButton("ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª","back-manage-chat")
    )
    
    if query=='bot-setting':
        bot_settings_text = """

Ù…ÛŒØªÙˆÙ†ÛŒØ¯ Ø§Ø²ÛŒÙ† ÙØ³Ù…Øª Ø±Ø¨Ø§Øª Ø±Ùˆ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯
Ø­Ø§Ù„Øª Ø§Ù†ØªØ´Ø§Ø± ÙØ¹Ù„ÛŒ : {}
        """.format(get_settings(setting_option='status')['redirect-type'])
        kb = InlineKeyboard(row_width=1)
        kb.row(
            InlineButton("ØªÙ†Ø¸ÛŒÙ… Ù†ÙˆØ¹ Ø§Ù†ØªØ´Ø§Ø±","redirect-type")
        )
        kb.row(
            InlineButton("ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª","back-to-main")
        )
        await q.edit_message_text(text=bot_settings_text,reply_markup=kb)
    elif query=='redirect-type':
        text = 'Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ Ú©Ù‡ Ù¾ÛŒØ§Ù… Ù‡Ø§ Ú†Ú¯ÙˆÙ†Ù‡ Ø¯Ø± Ú†Ù†Ù„ Ù…Ù‚ØµØ¯ Ù…Ù†ØªØ´Ø± Ø¨Ø´Ù†'
        kb = InlineKeyboard()
        kb.row(
            InlineButton("Ú©Ù¾ÛŒ","copy"),
            InlineButton('ÙÙˆØ±ÙˆØ§Ø±Ø¯','forward')
        )
        await q.edit_message_text(text=text,reply_markup=kb)
        
    elif query=='copy':
        await q.answer("Ø§Ø²ÛŒÙ† Ø¨Ù‡ Ø¨Ø¹Ø¯ Ù¾ÛŒØ§Ù… Ù‡Ø§ Ø§Ø² Ù…Ø¨Ø¯Ø§ Ø¨Ù‡ Ù…Ù‚ØµØ¯ Ú©Ù¾ÛŒ Ù…ÛŒØ´ÙˆØ¯",show_alert=True)  
       
        text = "ÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡ Ù‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯"
        admin_dash_kb = InlineKeyboard(row_width=2)
        admin_dash_kb.add(
            InlineButton("ğŸ”§ Ù…Ø¯ÛŒØ±ÛŒØª Ú†Øª Ù‡Ø§","manage-chats"),
            InlineButton("âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ø¨Ø§Øª","bot-setting"),

            InlineButton("ğŸ“Ø±Ø§Ù‡Ù†Ù…Ø§","help"),

        )
        await q.edit_message_text(text=text,reply_markup=admin_dash_kb) 
        bot_settings.update_one({"_id":"status"},{"$set":{"redirect-type":"copy"}}) 
        save_settings()
    elif query=='forward':
        await q.answer("Ø§Ø²ÛŒÙ† Ø¨Ù‡ Ø¨Ø¹Ø¯ Ù¾ÛŒØ§Ù… Ù‡Ø§ Ø§Ø² Ù…Ø¨Ø¯Ø§ Ø¨Ù‡ Ù…Ù‚ØµØ¯ ÙÙˆØ±ÙˆØ§Ø±Ø¯ Ù…ÛŒØ´ÙˆØ¯",show_alert=True)    
        text = "ÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡ Ù‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯"
        admin_dash_kb = InlineKeyboard(row_width=2)
        admin_dash_kb.add(
            InlineButton("ğŸ”§ Ù…Ø¯ÛŒØ±ÛŒØª Ú†Øª Ù‡Ø§","manage-chats"),
            InlineButton("âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ø¨Ø§Øª","bot-setting"),

            InlineButton("ğŸ“Ø±Ø§Ù‡Ù†Ù…Ø§","help"),

        )
        await q.edit_message_text(text=text,reply_markup=admin_dash_kb)  
        bot_settings.update_one({"_id":"status"},{"$set":{"redirect-type":"forward"}}) 
        save_settings()  
        
        
        
        
    elif query.split(':')[0]=='settings':
        chat  = query.split(':')[1]
        chat_setting_kb = InlineKeyboard(row_width=1)
        data = get_chat_data(chat_id=int(chat))
        text = "Ù…ÛŒØªÙˆÙ†ÛŒØ¯ Ø§ÛŒÙ†Ø¬Ø§ Ú†Ù†Ù„ Ø±Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù†ÛŒØ¯ : "
        if data['status']==True:
            chat_setting_kb.row(
                InlineButton("âŒ ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù†","status:false:{}".format(chat))
            )
        else:
            chat_setting_kb.row(
                InlineButton("âœ… ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù†","status:true:{}".format(chat))
            )
        chat_setting_kb.row(
            InlineButton("ÙÛŒÙ„ØªØ± Ú©Ù„Ù…Ø§Øª","filter-words:{}".format(chat))
        )  
        chat_setting_kb.row(
            InlineButton("ÙÛŒÙ„ØªØ± ØªØ¹Ø¯Ø§Ø¯","filter-numbers:{}".format(chat))
        )      
        chat_setting_kb.row(
            InlineButton("Ø­Ø°Ù","delete:{}".format(chat))
        ) 
        chat_setting_kb.row(
            InlineButton("ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª","show-chats")
        )
        await q.edit_message_text(text=text,reply_markup=chat_setting_kb)     
        
        
        
    
    elif query.split(':')[0]=='status':
        #changinf chnnel listening ststus
        chat = query.split(':')[-1]
        status_type = query.split(':')[1]
        if status_type=='false':
            
            chat_collection.update_one({'_id':int(chat)},{"$set":{"status":False}})
            save_chats()
        else:
            chat_collection.update_one({'_id':int(chat)},{"$set":{"status":True}})
            save_chats()    
            
        text = "Ù…ÛŒØªÙˆÙ†ÛŒØ¯ Ø§ÛŒÙ†Ø¬Ø§ Ú†Ù†Ù„ Ø±Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù†ÛŒØ¯ : "    
        data = get_chat_data(chat_id=int(chat))
        if data['status']==True:
            chat_setting_kb = InlineKeyboard()
            chat_setting_kb.row(
                InlineButton("âŒ ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù†","status:false:{}".format(chat))
            )
        else:
            chat_setting_kb = InlineKeyboard()
            chat_setting_kb.row(
                InlineButton("âœ… ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù†","status:true:{}".format(chat))
            )
        chat_setting_kb.row(
            InlineButton("ÙÛŒÙ„ØªØ± Ú©Ù„Ù…Ø§Øª","filter-words:{}".format(chat))
        )  
        chat_setting_kb.row(
            InlineButton("ÙÛŒÙ„ØªØ± ØªØ¹Ø¯Ø§Ø¯","filter-numbers:{}".format(chat))
        )  
        
        chat_setting_kb.row(
            InlineButton("Ø­Ø°Ù","delete:{}".format(chat))
        ) 
        
        
        
        chat_setting_kb.row(
            InlineButton("ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª","show-chats")
        )
        await q.edit_message_text(text=text,reply_markup=chat_setting_kb)  
    
    
    
    elif query.split(":")[0]=='filter-words':
        kb = InlineKeyboard(row_width=1)
        kb.add(
            InlineButton("Ù‡Ù…Ù‡ Ù¾ÛŒØ§Ù… Ù‡Ø§","2all:{}".format(query.split(":")[1])),
            InlineButton("ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª","back-manage-chat")
        )
        text = 'Ú©Ù„Ù…Ø§Øª Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± Ø´Ø¯Ù† Ø¯Ø± Ø§Ù†ØªØ³Ø§Ø± Ù¾ÛŒØ§Ù… Ø±Ùˆ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø¨ÛŒØ´ Ø§Ø² ÛŒÚ© Ú©Ù„Ù…Ù‡ Ø§ÙˆÙ†Ù‡Ø§ Ø±Ùˆ Ø¨Ø§ Ú©Ø§Ù…Ø§ ÛŒØ§ ÙˆÛŒØ±Ú¯ÙˆÙ„ Ø§Ø² Ù‡Ù… Ø¬Ø¯Ø§ Ú©Ù†ÛŒØ¯'      
        await q.edit_message_text(text=text,reply_markup=kb)
        admin_action = query
    elif query.split(":")[0]=='filter-numbers':
        text = 'ØªØ¹Ø¯Ø§Ø¯ Ù¾ÛŒØ§Ù… Ù‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¯Ø± Ø±ÙˆØ² Ù‚ØµØ¯ Ø¯Ø§Ø±ÛŒØ¯ Ø§Ù†ØªØ´Ø§Ø± Ø¯Ø§Ø¯Ù‡ Ø¨Ø´Ù† ØªÙˆ Ú†Ù†Ù„ Ù…Ù‚ØµØ¯ Ø±Ùˆ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯'  
        
        kb = InlineKeyboard(row_width=1)
        kb.add(
            InlineButton("Ù‡Ù…Ù‡ Ù¾ÛŒØ§Ù… Ù‡Ø§","1all:{}".format(query.split(":")[1])),
            InlineButton("ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª","back-manage-chat")
        )
        await q.edit_message_text(text=text,reply_markup=kb)
        admin_action = query
        
    elif query.split(':')[0]=='1all':
        await q.answer("Ù‡Ù…Ù‡ Ù¾ÛŒØ§Ù… Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø§Ø² Ø­Ø§Ù„Ø§ Ø§Ø² Ù¾Ù†Ù„ Ù…Ø¨Ø¯Ø§ Ø¨Ù‡ Ù…Ù‚ØµØ¯ Ø§Ø±Ø³Ø§Ù„ Ø®ÙˆØ§Ù‡Ù†Ø¯ Ø´Ø¯",show_alert=True)
        text = "ÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡ Ù‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯"
        admin_dash_kb = InlineKeyboard(row_width=2)
        admin_dash_kb.add(
            InlineButton("ğŸ”§ Ù…Ø¯ÛŒØ±ÛŒØª Ú†Øª Ù‡Ø§","manage-chats"),
            InlineButton("âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ø¨Ø§Øª","bot-setting"),

            InlineButton("ğŸ“Ø±Ø§Ù‡Ù†Ù…Ø§","help"),

        )
        admin_action = ''
        await q.edit_message_text(text=text,reply_markup=admin_dash_kb)  
        chat_collection.update_one({"_id":int(query.split(':')[1])},{"$set":{"message_per_day":''}})
        save_chats()  
    elif query.split(':')[0]=='2all':
        await q.answer("Ù‡Ù…Ù‡ Ù¾ÛŒØ§Ù… Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø§Ø² Ø­Ø§Ù„Ø§ Ø§Ø² Ù¾Ù†Ù„ Ù…Ø¨Ø¯Ø§ Ø¨Ù‡ Ù…Ù‚ØµØ¯ Ø§Ø±Ø³Ø§Ù„ Ø®ÙˆØ§Ù‡Ù†Ø¯ Ø´Ø¯",show_alert=True)
        text = "ÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡ Ù‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯"
        admin_dash_kb = InlineKeyboard(row_width=2)
        admin_dash_kb.add(
            InlineButton("ğŸ”§ Ù…Ø¯ÛŒØ±ÛŒØª Ú†Øª Ù‡Ø§","manage-chats"),
            InlineButton("âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ø¨Ø§Øª","bot-setting"),

            InlineButton("ğŸ“Ø±Ø§Ù‡Ù†Ù…Ø§","help"),

        )
        admin_action = ''
        await q.edit_message_text(text=text,reply_markup=admin_dash_kb)  
        chat_collection.update_one({"_id":int(query.split(':')[1])},{"$set":{"keyword":''}})
        save_chats()        
    elif query=='manage-chats':
        manage_chats_kb = InlineKeyboard(row_width=1)
        manage_chats_kb.add(
            
            InlineButton("ğŸ—„ Ú†Øª Ù‡Ø§ÛŒ Ù…ØªØµÙ„","show-chats"),
            InlineButton("ğŸ—‘ Ø­Ø°Ù Ú†Øª","remove-chat"),
            InlineButton("ğŸ”– Ø§ÙØ²ÙˆØ¯Ù† Ú†Øª","add-chat"),
            InlineButton("ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª","back-to-main")

        )
        photo = '[â€ ](https://telegra.ph/file/ce20cd7490dd2c5a4a18c.jpg)'
        text_manage = "Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ø§Ù…Ù‡ ÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡ Ù‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ \n"+photo
        await q.edit_message_text(text=text_manage,reply_markup=manage_chats_kb)
    elif query=='add-chat':
        photo = '[â€ ](https://telegra.ph/file/99afb740d769531f93e5f.jpg)'
        add_chat_text= """â€â„¹ï¸ Ø¨Ø®Ø´ Ø§ÙØ²ÙˆØ¯Ù† Ú†Øª 
â€Ø§Ø¯Ù…ÛŒÙ† Ù…Ø­ØªØ±Ù… Ù„ÛŒÙ†Ú© Ú†Øª Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ Ø¢ÛŒØ¯ÛŒ Ú†Øª Ø±Ùˆ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯  """+'\n'+photo
        admin_action = 'add_chat'
        await q.edit_message_text(text=add_chat_text,reply_markup=back_to_manage_chat_kb)
    elif query.split(":")[0]=='delete':
        chat = int(query.split(":")[1])
        await q.answer("Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯",show_alert=True)
        delete_chat(chat_id=chat)
        manage_chats_kb = InlineKeyboard(row_width=1)
        manage_chats_kb.add(
            
            InlineButton("ğŸ—„ Ú†Øª Ù‡Ø§ÛŒ Ù…ØªØµÙ„","show-chats"),
            InlineButton("ğŸ—‘ Ø­Ø°Ù Ú†Øª","remove-chat"),
            InlineButton("ğŸ”– Ø§ÙØ²ÙˆØ¯Ù† Ú†Øª","add-chat"),
            InlineButton("ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª","back-to-main")

        )
        try:
            await Cli.leave_chat(chat, delete=True)
        except:
            pass
        photo = '[â€ ](https://telegra.ph/file/ce20cd7490dd2c5a4a18c.jpg)'
        text_manage = "Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ø§Ù…Ù‡ ÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡ Ù‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ \n"+photo
        await q.edit_message_text(text=text_manage,reply_markup=manage_chats_kb)
    elif query.split(':')[0]=='chat':
            data = get_chat_data(chat_id=int(query.split(':')[1]))
            numeral_id = data['_id']
            title = data['title']
            status = 'Ø®Ø§Ù…ÙˆØ´' if data['status']=='off' else 'Ø±ÙˆØ´Ù†'
            per_message = data['message_per_day'] if data['message_per_day']!='' else 'Ù‡Ù…Ù‡ Ù¾ÛŒØ§Ù… Ù‡Ø§'
            word_filter = data['keyword'] if data['keyword']!='' else "Ù‡Ù…Ù‡ Ù¾ÛŒØ§Ù… Ù‡Ø§"
            text ="""â€¢ Ø¹Ù†ÙˆØ§Ù† Ú†Ù†Ù„ : {}

â€¢ Ø¢ÛŒØ¯ÛŒ Ø¹Ø¯Ø¯ÛŒ Ú†Ù†Ù„ : {}

â€¢ ØªØ¹Ø¯Ø§Ø¯ Ù¾ÛŒØ§Ù… ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡ : {}

â€¢ ÙˆØ¶Ø¹ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ú†Ù†Ù„ Ù…Ù‚ØµØ¯ : {}

â€¢ ÙÛŒÙ„ØªØ± Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯Ù‡ Ø±ÙˆÛŒ Ù¾ÛŒØ§Ù… Ù‡Ø§ : {}

ğŸ“Ÿ Ø¨Ø±Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÛŒÙ† Ú†Ù†Ù„ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡ Ù‡Ø§ÛŒ Ø²ÛŒØ± Ù…ÛŒØªÙˆÙ†ÛŒØ¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯  : 

â–â–â–â–â–â–â–â–""".format(
    
    title,
    numeral_id,
    per_message,
    status,
    word_filter
    
    
    
    
)
            
            chat_setting_kb = InlineKeyboard(row_width=1)
            chat_setting_kb.add(
                InlineButton("âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú†Ù†Ù„","settings:{}".format(query.split(':')[1])),
                InlineButton("ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª","show-chats")
            )
        
            await q.edit_message_text(text=text,reply_markup=chat_setting_kb)    
    
    
    
    
    elif query=='remove-chat':
        photo = '[â€ ](https://telegra.ph/file/eabd335e06eae40da0ef5.jpg)'
        remove_chat_text= """â€â„¹ï¸ Ø¨Ø®Ø´ Ø­Ø°Ù Ú†Øª 
â€Ø§Ø¯Ù…ÛŒÙ† Ù…Ø­ØªØ±Ù…  Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù Ú†Øª Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø±ØªÙˆÙ† Ø±Ùˆ Ø§Ø² Ø¨Ø®Ø´ Ø²ÛŒØ± Ú†Øª Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯"""
        await q.edit_message_text(text=remove_chat_text,reply_markup=make_chats_kb())
        pass
    elif query=='show-chats':
        photo = '[â€ ](https://telegra.ph/file/cd1fb758da9d62a1a3df6.jpg)'
        show_chats_text= """â€â„¹ï¸ Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒØ³Øª Ú†Øª Ù‡Ø§
â€Ø§Ø¯Ù…ÛŒÙ† Ù…Ø­ØªØ±Ù…  ØªÙˆ Ø§ÛŒÙ† Ø¨Ø®Ø´ Ù…ÛŒØªÙˆÙ†ÛŒØ¯ Ú†Øª Ù‡Ø§ÛŒ Ù…ØªØµÙ„ Ø¨Ù‡ Ø±Ø¨Ø§Øª Ø±Ùˆ Ø¨Ø¨ÛŒÙ†ÛŒØ¯ ØŒ Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù‡Ø± Ú†Øª Ùˆ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ† Ú©Ø§ÙÛŒÙ‡ Ø±Ùˆ Ú†Øª Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯"""+'\n'+photo
        
        await q.edit_message_text(text=show_chats_text,reply_markup=make_chats_kb())
    
    elif query=='back-to-main':
        admin_dash_kb = InlineKeyboard(row_width=2)
        admin_dash_kb.add(
            InlineButton("ğŸ”§ Ù…Ø¯ÛŒØ±ÛŒØª Ú†Øª Ù‡Ø§","manage-chats"),
            InlineButton("âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ø¨Ø§Øª","bot-setting"),

            InlineButton("ğŸ“Ø±Ø§Ù‡Ù†Ù…Ø§","help"),

        )
        
        admin_dash_text = """Ø³Ù„Ø§Ù… {} Ø¹Ø²ÛŒØ² ğŸ‘‹ğŸ»
    âœ¦ Ø§Ø¯Ù…ÛŒÙ† Ù…Ø­ØªØ±Ù… Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ø§Ù…Ù‡ ÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡ Ù‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯

    [â€ ](https://telegra.ph/file/7dbf04b6aa0c6edb6b143.jpg)""".format(user_name)
        
        await q.edit_message_text(text=admin_dash_text,reply_markup=admin_dash_kb)
    elif query=='back-manage-chat':
        manage_chats_kb = InlineKeyboard(row_width=1)
        manage_chats_kb.add(
            
            InlineButton("ğŸ—„ Ú†Øª Ù‡Ø§ÛŒ Ù…ØªØµÙ„","show-chats"),
            InlineButton("ğŸ—‘ Ø­Ø°Ù Ú†Øª","remove-chat"),
            InlineButton("ğŸ”– Ø§ÙØ²ÙˆØ¯Ù† Ú†Øª","add-chat"),
            InlineButton("ğŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª","back-to-main")

        )
        photo = '[â€ ](https://telegra.ph/file/ce20cd7490dd2c5a4a18c.jpg)'
        text_manage = "Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ø§Ù…Ù‡ ÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡ Ù‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ \n"+photo
        await q.edit_message_text(text=text_manage,reply_markup=manage_chats_kb)  
